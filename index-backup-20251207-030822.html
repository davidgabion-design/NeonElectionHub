<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Voting System</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, updateDoc, deleteDoc, onSnapshot, query, where, serverTimestamp, writeBatch, orderBy, increment } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyBNuIYfcsi2NWkK1Ua4Tnycaf_qM3oix1s",
            authDomain: "neon-voting-app.firebaseapp.com",
            projectId: "neon-voting-app",
            storageBucket: "neon-voting-app.firebasestorage.app",
            messagingSenderId: "406871836482",
            appId: "1:406871836482:web:b25063cd3829cd3dc6aadb",
            measurementId: "G-VGW2Z3FR8M"
        };
        
        let app, db;
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            console.log("✅ Firebase initialized");
            window.firebaseInitialized = true;
            window.db = db;
        } catch (error) {
            console.error("❌ Firebase error:", error);
        }
        
        window.firebaseModules = {
            getFirestore, collection, doc, setDoc, getDoc, getDocs, updateDoc, deleteDoc, 
            onSnapshot, query, where, serverTimestamp, writeBatch, orderBy, increment
        };
    </script>
    
    <style>
        :root {
            --primary-blue: #00C3FF;
            --primary-purple: #9D00FF;
            --primary-green: #00FFAA;
            --primary-pink: #FF00FF;
            --primary-yellow: #FFD700;
            --dark-bg: #0a0a1a;
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-border: rgba(0, 195, 255, 0.15);
            --text-light: #ffffff;
            --text-gray: #a0a0c0;
            --success: #00FFAA;
            --warning: #FFAA00;
            --error: #FF4444;
            --info: #00C3FF;
        }
        
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            font-family: 'Poppins', sans-serif; 
        }
        
        body {
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: var(--text-light);
            overflow-x: hidden;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(157, 0, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 195, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(0, 255, 170, 0.1) 0%, transparent 50%);
            z-index: -1;
        }
        
        /* ===== GLASS EFFECT ===== */
        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .glass-effect-dark {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }
        
        /* ===== TOP NAVIGATION ===== */
        .top-nav {
            width: 100%;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(10, 10, 26, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(0, 195, 255, 0.2);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary-purple), var(--primary-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: white;
            box-shadow: 0 0 20px rgba(157, 0, 255, 0.4);
            animation: pulse 2s infinite;
        }
        
        .logo-text {
            display: flex;
            flex-direction: column;
        }
        
        .logo-title {
            font-size: 22px;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary-purple), var(--primary-blue));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 0.5px;
        }
        
        .logo-subtitle {
            font-size: 12px;
            color: var(--text-gray);
            font-weight: 400;
        }
        
        /* ===== GATEWAY CARDS ===== */
        .gateway-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 40px auto;
            max-width: 1200px;
            padding: 0 20px;
        }
        
        .gateway-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
            border-radius: 20px;
            padding: 35px 30px;
            text-align: center;
            position: relative;
            border: 2px solid transparent;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            overflow: hidden;
        }
        
        .gateway-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-purple), var(--primary-blue));
        }
        
        .gateway-card:hover {
            transform: translateY(-10px) scale(1.02);
            border-color: var(--primary-blue);
            box-shadow: 0 20px 40px rgba(0, 195, 255, 0.2);
        }
        
        .gateway-icon {
            font-size: 60px;
            margin-bottom: 25px;
            background: linear-gradient(90deg, var(--primary-purple), var(--primary-blue));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px rgba(157, 0, 255, 0.3));
        }
        
        .gateway-card h3 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--text-light);
        }
        
        .gateway-card p {
            color: var(--text-gray);
            line-height: 1.6;
            margin-bottom: 25px;
            font-size: 15px;
        }
        
        .credentials-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            border-left: 4px solid var(--primary-blue);
        }
        
        /* ===== BUTTONS ===== */
        .btn {
            border: none;
            cursor: pointer;
            padding: 14px 28px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        .neon-btn {
            background: linear-gradient(90deg, var(--primary-purple), var(--primary-blue));
            color: white;
            border: none;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .neon-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(157, 0, 255, 0.3);
        }
        
        .neon-btn-outline {
            background: transparent;
            border: 2px solid var(--primary-blue);
            color: var(--primary-blue);
        }
        
        .neon-btn-outline:hover {
            background: rgba(0, 195, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 195, 255, 0.2);
        }
        
        .btn-success {
            background: linear-gradient(90deg, #00b09b, #96c93d);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(90deg, #ff7e5f, #feb47b);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(90deg, #ff416c, #ff4b2b);
            color: white;
        }
        
        /* ===== SCREENS ===== */
        .screen {
            display: none;
            width: 100%;
            animation: fadeIn 0.5s ease;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ===== AUTH CARDS ===== */
        .auth-container {
            max-width: 500px;
            margin: 50px auto;
            padding: 0 20px;
        }
        
        .auth-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .auth-icon {
            font-size: 70px;
            margin-bottom: 20px;
            background: linear-gradient(90deg, var(--primary-purple), var(--primary-blue));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .auth-title {
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary-purple), var(--primary-blue));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .auth-subtitle {
            color: var(--text-gray);
            font-size: 16px;
        }
        
        /* ===== INPUT FIELDS ===== */
        .input-group {
            margin-bottom: 25px;
        }
        
        .input-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-light);
            font-weight: 500;
            font-size: 15px;
        }
        
        .input-field {
            width: 100%;
            padding: 16px 20px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.07);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary-blue);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 0 3px rgba(0, 195, 255, 0.1);
        }
        
        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        
        /* ===== PANELS ===== */
        .panel-container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 30px;
            border-radius: 24px;
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.08);
        }
        
        .panel-title {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary-purple), var(--primary-blue));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .panel-subtitle {
            color: var(--text-gray);
            font-size: 15px;
            margin-top: 5px;
        }
        
        /* ===== TAB SYSTEM ===== */
        .tab-container {
            margin-bottom: 30px;
        }
        
        .tab-header {
            display: flex;
            gap: 5px;
            background: rgba(255, 255, 255, 0.03);
            padding: 8px;
            border-radius: 16px;
            margin-bottom: 30px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 14px 20px;
            border: none;
            background: transparent;
            color: var(--text-gray);
            font-weight: 600;
            font-size: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .tab-btn.active {
            background: rgba(0, 195, 255, 0.15);
            color: var(--primary-blue);
            box-shadow: 0 5px 15px rgba(0, 195, 255, 0.1);
        }
        
        .tab-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-light);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ===== DATA CARDS ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.01));
            border-radius: 18px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-blue);
            box-shadow: 0 15px 30px rgba(0, 195, 255, 0.1);
        }
        
        .stat-icon {
            font-size: 36px;
            margin-bottom: 15px;
            background: linear-gradient(90deg, var(--primary-purple), var(--primary-blue));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: 800;
            color: var(--text-light);
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: var(--text-gray);
            font-size: 14px;
            font-weight: 500;
        }
        
        /* ===== TABLES ===== */
        .data-table-container {
            overflow-x: auto;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table thead {
            background: rgba(0, 195, 255, 0.1);
        }
        
        .data-table th {
            padding: 18px 20px;
            text-align: left;
            color: var(--primary-blue);
            font-weight: 600;
            font-size: 15px;
            border-bottom: 2px solid rgba(0, 195, 255, 0.2);
        }
        
        .data-table td {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: var(--text-light);
        }
        
        .data-table tbody tr:hover {
            background: rgba(0, 195, 255, 0.05);
        }
        
        /* ===== BADGES ===== */
        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.3px;
        }
        
        .badge-success {
            background: rgba(0, 255, 170, 0.15);
            color: var(--success);
            border: 1px solid rgba(0, 255, 170, 0.3);
        }
        
        .badge-warning {
            background: rgba(255, 170, 0, 0.15);
            color: var(--warning);
            border: 1px solid rgba(255, 170, 0, 0.3);
        }
        
        .badge-danger {
            background: rgba(255, 68, 68, 0.15);
            color: var(--error);
            border: 1px solid rgba(255, 68, 68, 0.3);
        }
        
        .badge-info {
            background: rgba(0, 195, 255, 0.15);
            color: var(--info);
            border: 1px solid rgba(0, 195, 255, 0.3);
        }
        
        /* ===== TOAST NOTIFICATION ===== */
        #toast-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 9999;
        }
        
        .toast {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 14px;
            padding: 18px 24px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-blue);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.5s ease, slideOut 0.5s ease 2.5s forwards;
            min-width: 300px;
            max-width: 400px;
        }
        
        .toast-success {
            border-left-color: var(--success);
            background: rgba(0, 255, 170, 0.1);
        }
        
        .toast-error {
            border-left-color: var(--error);
            background: rgba(255, 68, 68, 0.1);
        }
        
        .toast-warning {
            border-left-color: var(--warning);
            background: rgba(255, 170, 0, 0.1);
        }
        
        /* ===== LOADING ===== */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        /* ===== POSITION CARD STYLES ===== */
        .position-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.01));
            border-radius: 16px;
            padding: 25px;
            border: 1px solid rgba(0, 195, 255, 0.1);
            transition: all 0.3s ease;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .position-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(180deg, var(--primary-purple), var(--primary-blue));
        }
        
        .position-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-blue);
            box-shadow: 0 10px 30px rgba(0, 195, 255, 0.1);
        }
        
        .position-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .position-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-light);
            margin-bottom: 5px;
        }
        
        .position-description {
            color: var(--text-gray);
            font-size: 14px;
            line-height: 1.5;
        }
        
        .position-meta {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-gray);
            font-size: 13px;
        }
        
        .position-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .candidates-list {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .candidate-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.01);
            border-radius: 10px;
            margin-bottom: 10px;
            border: 1px solid rgba(255, 255, 255, 0.03);
        }
        
        .candidate-item:hover {
            background: rgba(0, 195, 255, 0.05);
        }
        
        .candidate-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-purple), var(--primary-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 18px;
        }
        
        .candidate-info {
            flex: 1;
        }
        
        .candidate-name {
            color: var(--text-light);
            font-weight: 600;
            margin-bottom: 3px;
        }
        
        .candidate-bio {
            color: var(--text-gray);
            font-size: 13px;
        }
        
        /* ===== MODAL STYLES ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: linear-gradient(145deg, rgba(10, 10, 26, 0.95), rgba(26, 26, 46, 0.95));
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(0, 195, 255, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary-purple), var(--primary-blue));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .modal-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: var(--text-light);
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            background: rgba(255, 68, 68, 0.2);
            color: var(--error);
        }
        
        /* ===== FORM STYLES ===== */
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        /* ===== ANIMATIONS ===== */
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        @keyframes ripple {
            0% { transform: scale(0, 0); opacity: 0.5; }
            100% { transform: scale(20, 20); opacity: 0; }
        }
        
        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .top-nav {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
            }
            
            .gateway-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .auth-card {
                padding: 30px 20px;
            }
            
            .panel-container {
                padding: 20px;
                margin: 20px;
            }
            
            .tab-header {
                flex-wrap: wrap;
            }
            
            .tab-btn {
                flex: 1 0 auto;
                min-width: 120px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                padding: 25px 20px;
            }
        }
        
        /* ===== UTILITY CLASSES ===== */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .w-full { width: 100%; }
        .mt-10 { margin-top: 10px; }
        .mt-20 { margin-top: 20px; }
        .mt-30 { margin-top: 30px; }
        .mb-10 { margin-bottom: 10px; }
        .mb-20 { margin-bottom: 20px; }
        .mb-30 { margin-bottom: 30px; }
        .hidden { display: none !important; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-10 { gap: 10px; }
        .gap-20 { gap: 20px; }
        .gap-30 { gap: 30px; }
        
        /* ===== CUSTOM SCROLLBAR ===== */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--primary-purple), var(--primary-blue));
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, var(--primary-blue), var(--primary-purple));
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Position Modal -->
    <div id="positionModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Create New Position</h2>
                <button class="modal-close" onclick="closePositionModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="modalBody">
                <!-- Content will be loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Gateway Screen -->
    <div id="gatewayScreen" class="screen active">
        <nav class="top-nav glass-effect-dark">
            <div class="logo-container">
                <div class="logo-icon">
                    <i class="fas fa-vote-yea"></i>
                </div>
                <div class="logo-text">
                    <div class="logo-title">NEON VOTING SYSTEM</div>
                    <div class="logo-subtitle">Secure • Transparent • Digital</div>
                </div>
            </div>
            <div class="flex items-center gap-20">
                <div class="flex items-center gap-10">
                    <i class="fas fa-circle" style="color: var(--success); font-size: 10px;"></i>
                    <span style="color: var(--text-gray); font-size: 14px;">Live</span>
                </div>
                <button class="btn neon-btn-outline" onclick="showScreen('publicScreen')">
                    <i class="fas fa-eye"></i> View Public Results
                </button>
            </div>
        </nav>

        <div class="auth-container">
            <div class="auth-card glass-effect">
                <div class="auth-header">
                    <div class="auth-icon">
                        <i class="fas fa-vote-yea"></i>
                    </div>
                    <h1 class="auth-title">Welcome to Neon Voting</h1>
                    <p class="auth-subtitle">Choose your role to continue</p>
                </div>

                <div class="gateway-grid">
                    <!-- Super Admin Card -->
                    <div class="gateway-card glass-effect" id="btn-superadmin">
                        <div class="gateway-icon">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <h3>Super Admin</h3>
                        <p>Full system access to manage organizations, users, and system configurations</p>
                        <div class="credentials-box">
                            <div class="flex items-center gap-10">
                                <i class="fas fa-key" style="color: var(--primary-blue);"></i>
                                <span>Password: <strong>admin123</strong></span>
                            </div>
                        </div>
                    </div>

                    <!-- EC Card -->
                    <div class="gateway-card glass-effect" id="btn-ec">
                        <div class="gateway-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <h3>Election Commissioner</h3>
                        <p>Manage elections, voters, candidates, and monitor voting progress</p>
                        <div class="credentials-box">
                            <div class="flex items-center gap-10">
                                <i class="fas fa-building" style="color: var(--primary-blue);"></i>
                                <span>Organization ID required</span>
                            </div>
                        </div>
                    </div>

                    <!-- Voter Card -->
                    <div class="gateway-card glass-effect" id="btn-voter">
                        <div class="gateway-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <h3>Voter</h3>
                        <p>Cast your vote securely using email authentication and OTP verification</p>
                        <div class="credentials-box">
                            <div class="flex items-center gap-10">
                                <i class="fas fa-envelope" style="color: var(--primary-blue);"></i>
                                <span>Email login required</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center mt-30">
                    <p style="color: var(--text-gray); font-size: 14px;">
                        <i class="fas fa-info-circle" style="margin-right: 5px;"></i>
                        Status: <span id="firebaseStatus" style="color: var(--success); font-weight: 600;">Checking connection...</span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Super Admin Login Screen -->
    <div id="superAdminLoginScreen" class="screen">
        <nav class="top-nav glass-effect-dark">
            <div class="logo-container">
                <div class="logo-icon">
                    <i class="fas fa-user-shield"></i>
                </div>
                <div class="logo-text">
                    <div class="logo-title">Super Admin Login</div>
                    <div class="logo-subtitle">System Administration Access</div>
                </div>
            </div>
            <button class="btn neon-btn-outline" onclick="showScreen('gatewayScreen')">
                <i class="fas fa-arrow-left"></i> Back to Home
            </button>
        </nav>

        <div class="auth-container">
            <div class="auth-card glass-effect">
                <div class="auth-header">
                    <div class="auth-icon">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <h1 class="auth-title">Super Admin Access</h1>
                    <p class="auth-subtitle">Enter your credentials to continue</p>
                </div>

                <div class="input-group">
                    <label class="input-label">
                        <i class="fas fa-key" style="margin-right: 8px;"></i>
                        Super Admin Password
                    </label>
                    <input type="password" id="super-admin-pass" class="input-field" 
                           placeholder="Enter super admin password" value="admin123">
                </div>

                <button class="btn neon-btn w-full" onclick="loginSuperAdmin()">
                    <i class="fas fa-sign-in-alt"></i> Login as Super Admin
                </button>

                <div class="text-center mt-30">
                    <p style="color: var(--text-gray); font-size: 14px;">
                        <i class="fas fa-info-circle" style="margin-right: 5px;"></i>
                        Default password: <strong>admin123</strong>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Super Admin Panel -->
    <div id="superAdminPanel" class="screen">
        <nav class="top-nav glass-effect-dark">
            <div class="logo-container">
                <div class="logo-icon">
                    <i class="fas fa-user-shield"></i>
                </div>
                <div class="logo-text">
                    <div class="logo-title">Super Admin Panel</div>
                    <div class="logo-subtitle">Manage Organizations & System</div>
                </div>
            </div>
            <div class="flex items-center gap-20">
                <button class="btn neon-btn" onclick="showScreen('gatewayScreen')">
                    <i class="fas fa-home"></i> Home
                </button>
                <button class="btn btn-danger" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </nav>

        <div class="panel-container glass-effect">
            <div class="panel-header">
                <div>
                    <h2 class="panel-title">
                        <i class="fas fa-building" style="margin-right: 10px;"></i>
                        Organizations Management
                    </h2>
                    <p class="panel-subtitle">Create and manage voting organizations</p>
                </div>
                <button class="btn neon-btn" onclick="refreshOrganizations()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>

            <!-- Organizations List -->
            <div id="organizationsList">
                <div class="loading-container">
                    <div class="spinner"></div>
                    <h3 style="color: var(--text-light); margin-bottom: 10px;">Loading Organizations...</h3>
                    <p style="color: var(--text-gray);">Please wait while we fetch your data</p>
                </div>
            </div>

            <!-- Create Organization Form -->
            <div class="mt-30" style="background: rgba(0, 195, 255, 0.05); padding: 30px; border-radius: 20px; border: 2px solid rgba(0, 195, 255, 0.1);">
                <h3 style="color: var(--primary-blue); margin-bottom: 20px; font-size: 22px;">
                    <i class="fas fa-plus-circle" style="margin-right: 10px;"></i>
                    Create New Organization
                </h3>
                
                <div class="grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div class="input-group">
                        <label class="input-label">Organization Name</label>
                        <input type="text" id="newOrgName" class="input-field" 
                               placeholder="Enter organization name" value="Demo University">
                    </div>
                    <div class="input-group">
                        <label class="input-label">EC Password</label>
                        <input type="text" id="newOrgPassword" class="input-field" 
                               placeholder="Enter EC password" value="ec123456">
                    </div>
                </div>
                
                <div class="input-group">
                    <label class="input-label">Description (Optional)</label>
                    <input type="text" id="newOrgDesc" class="input-field" 
                           placeholder="Enter description" value="Student Council Elections">
                </div>
                
                <button class="btn neon-btn w-full mt-20" onclick="createOrganization()">
                    <i class="fas fa-plus"></i> Create Organization
                </button>
            </div>
        </div>
    </div>

    <!-- EC Login Screen -->
    <div id="ecLoginScreen" class="screen">
        <nav class="top-nav glass-effect-dark">
            <div class="logo-container">
                <div class="logo-icon">
                    <i class="fas fa-user-tie"></i>
                </div>
                <div class="logo-text">
                    <div class="logo-title">EC Login</div>
                    <div class="logo-subtitle">Election Commissioner Access</div>
                </div>
            </div>
            <button class="btn neon-btn-outline" onclick="showScreen('gatewayScreen')">
                <i class="fas fa-arrow-left"></i> Back to Home
            </button>
        </nav>

        <div class="auth-container">
            <div class="auth-card glass-effect">
                <div class="auth-header">
                    <div class="auth-icon">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <h1 class="auth-title">EC Commissioner Login</h1>
                    <p class="auth-subtitle">Enter your organization credentials</p>
                </div>

                <div class="input-group">
                    <label class="input-label">
                        <i class="fas fa-building" style="margin-right: 8px;"></i>
                        Organization ID
                    </label>
                    <input type="text" id="ec-org-id" class="input-field" 
                           placeholder="Enter your organization ID">
                </div>

                <div class="input-group">
                    <label class="input-label">
                        <i class="fas fa-key" style="margin-right: 8px;"></i>
                        EC Password
                    </label>
                    <input type="password" id="ec-pass" class="input-field" 
                           placeholder="Enter EC password">
                </div>

                <button class="btn neon-btn w-full" onclick="loginEC()">
                    <i class="fas fa-sign-in-alt"></i> Login as Election Commissioner
                </button>

                <div class="text-center mt-30">
                    <p style="color: var(--text-gray); font-size: 14px;">
                        <i class="fas fa-info-circle" style="margin-right: 5px;"></i>
                        Demo: Org: <strong>demo.university.2024</strong>, Pass: <strong>cc123456</strong>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- EC Panel -->
    <div id="ecPanel" class="screen">
        <nav class="top-nav glass-effect-dark">
            <div class="logo-container">
                <div class="logo-icon">
                    <i class="fas fa-user-tie"></i>
                </div>
                <div class="logo-text">
                    <div class="logo-title" id="ecOrgName">EC Dashboard</div>
                    <div class="logo-subtitle" id="ecOrgStatus">Loading organization...</div>
                </div>
            </div>
            <div class="flex items-center gap-20">
                <div style="background: rgba(255, 255, 255, 0.1); padding: 8px 16px; border-radius: 12px;">
                    <span style="color: var(--text-gray); font-size: 13px;">ID: </span>
                    <span style="color: var(--primary-blue); font-weight: 600;" id="ecOrgIdDisplay">-</span>
                </div>
                <button class="btn neon-btn" onclick="showScreen('gatewayScreen')">
                    <i class="fas fa-home"></i> Home
                </button>
                <button class="btn btn-danger" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </nav>

        <div class="panel-container glass-effect">
            <!-- Stats Overview -->
            <div class="stats-grid mb-30">
                <div class="stat-card glass-effect">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-value" id="statVoters">0</div>
                    <div class="stat-label">Total Voters</div>
                </div>
                <div class="stat-card glass-effect">
                    <div class="stat-icon">
                        <i class="fas fa-vote-yea"></i>
                    </div>
                    <div class="stat-value" id="statVotes">0</div>
                    <div class="stat-label">Votes Cast</div>
                </div>
                <div class="stat-card glass-effect">
                    <div class="stat-icon">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div class="stat-value" id="statTurnout">0%</div>
                    <div class="stat-label">Voter Turnout</div>
                </div>
                <div class="stat-card glass-effect">
                    <div class="stat-icon">
                        <i class="fas fa-hourglass-half"></i>
                    </div>
                    <div class="stat-value" id="statStatus">Active</div>
                    <div class="stat-label">Election Status</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tab-container">
                <div class="tab-header">
                    <button class="tab-btn active" data-ec-tab="voters" onclick="switchECTab('voters')">
                        <i class="fas fa-users"></i> Voters
                    </button>
                    <button class="tab-btn" data-ec-tab="positions" onclick="switchECTab('positions')">
                        <i class="fas fa-list-ol"></i> Positions
                    </button>
                    <button class="tab-btn" data-ec-tab="candidates" onclick="switchECTab('candidates')">
                        <i class="fas fa-user-friends"></i> Candidates
                    </button>
                    <button class="tab-btn" data-ec-tab="outcomes" onclick="switchECTab('outcomes')">
                        <i class="fas fa-chart-line"></i> Outcomes
                    </button>
                    <button class="tab-btn" data-ec-tab="settings" onclick="switchECTab('settings')">
                        <i class="fas fa-cog"></i> Settings
                    </button>
                </div>

                <!-- Tab Contents -->
                <div id="ecContent-voters" class="tab-content active">
                    <div id="votersContent"></div>
                </div>

                <div id="ecContent-positions" class="tab-content">
                    <div id="positionsContent">
                        <div class="loading-container">
                            <div class="spinner"></div>
                            <h3 style="color: var(--text-light); margin-bottom: 10px;">Loading Positions...</h3>
                            <p style="color: var(--text-gray);">Setting up positions management system</p>
                        </div>
                    </div>
                </div>

                <div id="ecContent-candidates" class="tab-content">
                    <div id="candidatesContent"></div>
                </div>

                <div id="ecContent-outcomes" class="tab-content">
                    <div id="outcomesContent"></div>
                </div>

                <div id="ecContent-settings" class="tab-content">
                    <div id="settingsContent"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Voter Login Screen -->
    <div id="voterLoginScreen" class="screen">
        <nav class="top-nav glass-effect-dark">
            <div class="logo-container">
                <div class="logo-icon">
                    <i class="fas fa-user-check"></i>
                </div>
                <div class="logo-text">
                    <div class="logo-title">Voter Login</div>
                    <div class="logo-subtitle">Cast Your Vote Securely</div>
                </div>
            </div>
            <button class="btn neon-btn-outline" onclick="showScreen('gatewayScreen')">
                <i class="fas fa-arrow-left"></i> Back to Home
            </button>
        </nav>

        <div class="auth-container">
            <div class="auth-card glass-effect">
                <div class="auth-header">
                    <div class="auth-icon">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <h1 class="auth-title">Voter Authentication</h1>
                    <p class="auth-subtitle">Enter your email to receive OTP</p>
                </div>

                <div class="input-group">
                    <label class="input-label">
                        <i class="fas fa-envelope" style="margin-right: 8px;"></i>
                        Email Address
                    </label>
                    <input type="email" id="voter-email" class="input-field" 
                           placeholder="your.email@example.com">
                </div>

                <button class="btn neon-btn w-full" onclick="voterSendOTP()">
                    <i class="fas fa-paper-plane"></i> Send OTP
                </button>

                <div id="voter-otp-group" class="hidden mt-30">
                    <div class="input-group">
                        <label class="input-label">
                            <i class="fas fa-shield-alt" style="margin-right: 8px;"></i>
                            Enter 6-digit OTP
                        </label>
                        <input type="text" id="voter-otp" class="input-field" 
                               placeholder="123456" maxlength="6">
                        <small style="color: var(--text-gray); font-size: 13px; margin-top: 5px; display: block;">
                            Check your email for the OTP code
                        </small>
                    </div>

                    <button class="btn neon-btn w-full" onclick="voterVerifyOTP()">
                        <i class="fas fa-check-circle"></i> Verify & Vote
                    </button>
                </div>

                <div class="text-center mt-30">
                    <p style="color: var(--text-gray); font-size: 14px;">
                        <i class="fas fa-info-circle" style="margin-right: 5px;"></i>
                        Demo: Use any email, OTP: <strong>123456</strong>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App Script -->
    <script>
        // ===== GLOBAL VARIABLES =====
        let currentECOrg = null;
        let currentSuperAdmin = false;
        let currentPositions = [];
        let editingPositionId = null;

        // ===== TOAST NOTIFICATION SYSTEM =====
        function showToast(message, type = "info", duration = 3000) {
            const container = document.getElementById('toast-container');
            if (!container) return;

            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            if (type === 'error') icon = 'exclamation-circle';
            if (type === 'warning') icon = 'exclamation-triangle';
            
            toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px;">
                    <i class="fas fa-${icon}" style="font-size: 18px;"></i>
                    <div style="flex: 1; font-size: 14px;">${message}</div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; color: var(--text-gray); cursor: pointer; font-size: 16px;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.style.animation = 'slideOut 0.5s ease forwards';
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 500);
                }
            }, duration);
        }

        // ===== SCREEN MANAGEMENT =====
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.add('active');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // ===== LOGOUT FUNCTION =====
        function logout() {
            currentECOrg = null;
            currentSuperAdmin = false;
            currentPositions = [];
            
            localStorage.removeItem("currentOrgId");
            localStorage.removeItem("currentECPassword");
            localStorage.removeItem("isECLoggedIn");
            
            showToast("Logged out successfully", "success");
            showScreen('gatewayScreen');
        }

        // ===== FIREBASE CONNECTION CHECK =====
        function updateFirebaseStatus() {
            const statusEl = document.getElementById('firebaseStatus');
            if (!statusEl) return;
            
            if (window.firebaseInitialized) {
                statusEl.textContent = "Connected ✓";
                statusEl.style.color = "var(--success)";
            } else {
                statusEl.textContent = "Not Connected ✗";
                statusEl.style.color = "var(--error)";
            }
        }

        // ===== SUPER ADMIN FUNCTIONS =====
        async function loginSuperAdmin() {
            const password = document.getElementById("super-admin-pass").value.trim();
            
            if (!password) {
                showToast("Please enter super admin password", "error");
                return;
            }
            
            try {
                const { doc, getDoc, setDoc, serverTimestamp } = window.firebaseModules;
                const ref = doc(db, "meta", "superAdmin");
                const snap = await getDoc(ref);
                
                if (!snap.exists()) {
                    const defaultPass = "admin123";
                    await setDoc(ref, {
                        password: defaultPass,
                        createdAt: serverTimestamp(),
                        version: "1.0"
                    });
                    
                    if (password === defaultPass) {
                        currentSuperAdmin = true;
                        showScreen("superAdminPanel");
                        loadSuperOrganizations();
                        showToast("Super Admin created and logged in!", "success");
                    } else {
                        showToast("First-time password is: admin123", "error");
                    }
                } else {
                    const adminData = snap.data();
                    if (adminData.password === password) {
                        currentSuperAdmin = true;
                        showScreen("superAdminPanel");
                        loadSuperOrganizations();
                        showToast("Welcome back, Super Admin!", "success");
                    } else {
                        showToast("Invalid password", "error");
                    }
                }
            } catch (error) {
                console.error("Super Admin login error:", error);
                showToast("Login failed: " + error.message, "error");
            }
        }

        async function loadSuperOrganizations() {
            const container = document.getElementById("organizationsList");
            if (!container) return;
            
            container.innerHTML = `
                <div class="loading-container">
                    <div class="spinner"></div>
                    <h3 style="color: var(--text-light); margin-bottom: 10px;">Loading Organizations...</h3>
                    <p style="color: var(--text-gray);">Fetching data from database</p>
                </div>
            `;
            
            try {
                const { collection, getDocs } = window.firebaseModules;
                const orgsSnapshot = await getDocs(collection(db, "organizations"));
                
                if (orgsSnapshot.empty) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 50px 20px;">
                            <i class="fas fa-building" style="font-size: 60px; color: var(--primary-blue); opacity: 0.5; margin-bottom: 20px;"></i>
                            <h3 style="color: var(--text-light); margin-bottom: 10px;">No Organizations Found</h3>
                            <p style="color: var(--text-gray);">Create your first organization below</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px;">';
                
                orgsSnapshot.forEach(doc => {
                    const org = doc.data();
                    const voterCount = org.voterCount || 0;
                    const voteCount = org.voteCount || 0;
                    
                    let createdDate = "N/A";
                    if (org.createdAt) {
                        if (typeof org.createdAt.toDate === 'function') {
                            createdDate = org.createdAt.toDate().toLocaleDateString();
                        } else if (typeof org.createdAt === 'string') {
                            createdDate = new Date(org.createdAt).toLocaleDateString();
                        }
                    }
                    
                    const status = org.electionStatus || "active";
                    let statusBadge = "badge-success";
                    if (status === "inactive") statusBadge = "badge-danger";
                    if (status === "closed") statusBadge = "badge-warning";
                    
                    html += `
                        <div class="stat-card glass-effect" style="cursor: default;">
                            <div style="display: flex; align-items: flex-start; gap: 15px; margin-bottom: 20px;">
                                <div style="width: 50px; height: 50px; border-radius: 12px; 
                                      background: linear-gradient(135deg, var(--primary-purple), var(--primary-blue));
                                      display: flex; align-items: center; justify-content: center;
                                      color: white; font-size: 22px; font-weight: 700;">
                                    ${org.name ? org.name.charAt(0).toUpperCase() : 'O'}
                                </div>
                                <div style="flex: 1;">
                                    <h4 style="color: var(--text-light); font-size: 18px; margin-bottom: 5px;">
                                        ${org.name || "Unnamed Organization"}
                                    </h4>
                                    <div style="color: var(--text-gray); font-size: 13px; margin-bottom: 8px;">
                                        ID: <code style="background: rgba(255,255,255,0.05); padding: 2px 6px; border-radius: 4px;">${doc.id}</code>
                                    </div>
                                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                        <span class="${statusBadge}">${status}</span>
                                        <span style="color: var(--text-gray); font-size: 13px;">
                                            <i class="fas fa-calendar" style="margin-right: 3px;"></i> ${createdDate}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                                <div style="flex: 1; text-align: center;">
                                    <div style="font-size: 20px; font-weight: 700; color: var(--primary-blue);">
                                        ${voterCount}
                                    </div>
                                    <div style="font-size: 12px; color: var(--text-gray);">Voters</div>
                                </div>
                                <div style="flex: 1; text-align: center;">
                                    <div style="font-size: 20px; font-weight: 700; color: var(--primary-green);">
                                        ${voteCount}
                                    </div>
                                    <div style="font-size: 12px; color: var(--text-gray);">Votes</div>
                                </div>
                                <div style="flex: 1; text-align: center;">
                                    <div style="font-size: 20px; font-weight: 700; color: var(--primary-yellow);">
                                        ${voterCount ? Math.round((voteCount / voterCount) * 100) : 0}%
                                    </div>
                                    <div style="font-size: 12px; color: var(--text-gray);">Turnout</div>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 10px;">
                                <button class="btn neon-btn-outline" style="flex: 1; padding: 10px;" 
                                        onclick="openOrgAsEC('${doc.id}')">
                                    <i class="fas fa-user-tie"></i> EC Login
                                </button>
                                <button class="btn" style="background: rgba(255,255,255,0.05); color: var(--text-light); padding: 10px;"
                                        onclick="showPassword('${org.ecPassword || ''}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
                
            } catch (error) {
                console.error("Error loading organizations:", error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 50px 20px; color: var(--error);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                        <h3>Error Loading Organizations</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        async function createOrganization() {
            const name = document.getElementById("newOrgName").value.trim();
            const description = document.getElementById("newOrgDesc").value.trim();
            const ecPassword = document.getElementById("newOrgPassword").value.trim();
            
            if (!name || !ecPassword) {
                showToast("Please enter organization name and EC password", "error");
                return;
            }
            
            if (ecPassword.length < 6) {
                showToast("EC password must be at least 6 characters", "warning");
                return;
            }
            
            try {
                const { doc, setDoc, serverTimestamp } = window.firebaseModules;
                
                const orgId = name.toLowerCase()
                    .replace(/[^a-z0-9]/g, '-')
                    .replace(/-+/g, '-')
                    .replace(/^-|-$/g, '') 
                    + '-' + Date.now().toString(36);
                
                const orgRef = doc(db, "organizations", orgId);
                
                await setDoc(orgRef, {
                    id: orgId,
                    name: name,
                    description: description || "",
                    ecPassword: ecPassword,
                    voterCount: 0,
                    voteCount: 0,
                    electionStatus: "active",
                    publicEnabled: false,
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp(),
                    createdBy: "superadmin"
                });
                
                document.getElementById("newOrgName").value = "";
                document.getElementById("newOrgDesc").value = "";
                document.getElementById("newOrgPassword").value = "ec123456";
                
                showToast(`Organization "${name}" created successfully!`, "success");
                loadSuperOrganizations();
                
            } catch (error) {
                console.error("Error creating organization:", error);
                showToast("Failed to create organization: " + error.message, "error");
            }
        }

        function openOrgAsEC(orgId) {
            showScreen('ecLoginScreen');
            const orgInput = document.getElementById('ec-org-id');
            if (orgInput) {
                orgInput.value = orgId;
                orgInput.focus();
            }
            showToast(`Organization ID "${orgId}" loaded. Enter EC password.`, "info");
        }

        function showPassword(password) {
            showToast(`EC Password: ${password}`, "info", 5000);
        }

        function refreshOrganizations() {
            loadSuperOrganizations();
            showToast("Refreshing organizations...", "info");
        }

        // ===== EC FUNCTIONS =====
        async function loginEC() {
            const orgId = document.getElementById('ec-org-id').value.trim();
            const password = document.getElementById('ec-pass').value.trim();
            
            if (!orgId || !password) {
                showToast("Please enter organization ID and password", "error");
                return;
            }
            
            showToast("Authenticating...", "info");
            
            try {
                const { doc, getDoc } = window.firebaseModules;
                const orgRef = doc(db, "organizations", orgId);
                const orgSnap = await getDoc(orgRef);
                
                if (!orgSnap.exists()) {
                    showToast("Organization not found", "error");
                    return;
                }
                
                const orgData = orgSnap.data();
                
                if (orgData.electionStatus === "inactive" || orgData.electionStatus === "closed") {
                    showToast("Organization is currently inactive", "warning");
                    return;
                }
                
                if (orgData.ecPassword !== password) {
                    showToast("Invalid EC password", "error");
                    return;
                }
                
                localStorage.setItem("currentOrgId", orgId);
                localStorage.setItem("currentECPassword", password);
                localStorage.setItem("isECLoggedIn", "true");
                
                currentECOrg = {
                    id: orgId,
                    name: orgData.name || orgId,
                    ecPassword: orgData.ecPassword,
                    electionStatus: orgData.electionStatus || "active",
                    voterCount: orgData.voterCount || 0,
                    voteCount: orgData.voteCount || 0,
                    ...orgData
                };
                
                document.getElementById('ecOrgName').textContent = orgData.name || orgId;
                document.getElementById('ecOrgStatus').textContent = `Status: ${orgData.electionStatus || "active"}`;
                document.getElementById('ecOrgIdDisplay').textContent = orgId;
                
                updateECStats();
                
                showScreen('ecPanel');
                switchECTab('voters');
                
                showToast(`Welcome, Election Commissioner of ${orgData.name || orgId}`, "success");
                
            } catch (error) {
                console.error("EC login error:", error);
                showToast("Login failed: " + error.message, "error");
            }
        }

        function updateECStats() {
            if (!currentECOrg) return;
            
            document.getElementById('statVoters').textContent = currentECOrg.voterCount || 0;
            document.getElementById('statVotes').textContent = currentECOrg.voteCount || 0;
            
            const turnout = currentECOrg.voterCount 
                ? Math.round((currentECOrg.voteCount / currentECOrg.voterCount) * 100) 
                : 0;
            document.getElementById('statTurnout').textContent = `${turnout}%`;
            
            const status = currentECOrg.electionStatus || "active";
            document.getElementById('statStatus').textContent = status.charAt(0).toUpperCase() + status.slice(1);
            document.getElementById('statStatus').style.color = 
                status === "active" ? "var(--success)" : 
                status === "closed" ? "var(--warning)" : "var(--error)";
        }

        function switchECTab(tabName) {
            document.querySelectorAll('#ecPanel .tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-ec-tab') === tabName);
            });
            
            document.querySelectorAll('#ecPanel .tab-content').forEach(content => {
                content.classList.toggle('active', content.id === `ecContent-${tabName}`);
            });
            
            loadTabContent(tabName);
        }

        function loadTabContent(tabName) {
            switch(tabName) {
                case 'voters':
                    loadVotersTab();
                    break;
                case 'positions':
                    loadPositionsTab();
                    break;
                case 'candidates':
                    loadCandidatesTab();
                    break;
                case 'outcomes':
                    loadOutcomesTab();
                    break;
                case 'settings':
                    loadSettingsTab();
                    break;
            }
        }

        // ===== POSITIONS MANAGEMENT FUNCTIONS =====
        async function loadPositionsTab() {
            const container = document.getElementById('positionsContent');
            if (!container || !currentECOrg) return;
            
            container.innerHTML = `
                <div class="loading-container">
                    <div class="spinner"></div>
                    <h3 style="color: var(--text-light); margin-bottom: 10px;">Loading Positions...</h3>
                    <p style="color: var(--text-gray);">Fetching positions data</p>
                </div>
            `;
            
            showToast("Loading positions...", "info");
            
            try {
                const { collection, getDocs } = window.firebaseModules;
                const positionsRef = collection(db, "organizations", currentECOrg.id, "positions");
                const positionsSnap = await getDocs(positionsRef);
                
                currentPositions = [];
                positionsSnap.forEach(doc => {
                    currentPositions.push({ id: doc.id, ...doc.data() });
                });
                
                renderPositionsList();
                
                showToast(`Loaded ${currentPositions.length} positions`, "success");
                
            } catch (error) {
                console.error("Error loading positions:", error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 50px 20px; color: var(--error);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                        <h3>Error Loading Positions</h3>
                        <p>${error.message}</p>
                        <button class="btn neon-btn mt-20" onclick="loadPositionsTab()">
                            <i class="fas fa-sync-alt"></i> Try Again
                        </button>
                    </div>
                `;
            }
        }

        function renderPositionsList() {
            const container = document.getElementById('positionsContent');
            if (!container) return;
            
            if (currentPositions.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 50px 20px;">
                        <div style="font-size: 80px; color: var(--primary-blue); opacity: 0.3; margin-bottom: 20px;">
                            <i class="fas fa-list-ol"></i>
                        </div>
                        <h3 style="color: var(--text-light); margin-bottom: 10px;">No Positions Created</h3>
                        <p style="color: var(--text-gray); margin-bottom: 30px;">
                            Positions define the roles that candidates will run for in your election.
                            Examples: President, Vice President, Secretary, Treasurer.
                        </p>
                        <button class="btn neon-btn" onclick="createPosition()">
                            <i class="fas fa-plus"></i> Create First Position
                        </button>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h3 style="color: var(--text-light); font-size: 22px;">
                        <i class="fas fa-list-ol" style="color: var(--primary-blue); margin-right: 10px;"></i>
                        Election Positions (${currentPositions.length})
                    </h3>
                    <button class="btn neon-btn" onclick="createPosition()">
                        <i class="fas fa-plus"></i> Add Position
                    </button>
                </div>
                
                <div style="display: grid; gap: 20px;">
            `;
            
            currentPositions.forEach((position, index) => {
                const candidatesCount = position.candidates ? position.candidates.length : 0;
                const votesCount = position.votesCount || 0;
                
                html += `
                    <div class="position-card">
                        <div class="position-header">
                            <div style="flex: 1;">
                                <div class="position-title">
                                    <span style="background: linear-gradient(90deg, var(--primary-purple), var(--primary-blue)); 
                                          -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
                                        ${position.title || "Untitled Position"}
                                    </span>
                                </div>
                                <div class="position-description">
                                    ${position.description || "No description provided"}
                                </div>
                                <div class="position-meta">
                                    <div class="meta-item">
                                        <i class="fas fa-hashtag" style="color: var(--primary-blue);"></i>
                                        Position #${index + 1}
                                    </div>
                                    <div class="meta-item">
                                        <i class="fas fa-user-friends" style="color: var(--primary-green);"></i>
                                        ${candidatesCount} candidates
                                    </div>
                                    <div class="meta-item">
                                        <i class="fas fa-vote-yea" style="color: var(--primary-yellow);"></i>
                                        ${votesCount} votes
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn" style="padding: 8px 12px; background: rgba(0,195,255,0.1); color: var(--primary-blue);"
                                        onclick="editPosition('${position.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn" style="padding: 8px 12px; background: rgba(255,68,68,0.1); color: var(--error);"
                                        onclick="deletePosition('${position.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="position-actions">
                            <button class="btn neon-btn-outline" onclick="managePositionCandidates('${position.id}')">
                                <i class="fas fa-user-plus"></i> Manage Candidates
                            </button>
                            <button class="btn" style="background: rgba(157,0,255,0.1); color: var(--primary-purple);"
                                    onclick="viewPositionResults('${position.id}')">
                                <i class="fas fa-chart-bar"></i> View Results
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += `
                </div>
                
                <div style="text-align: center; margin-top: 40px; padding: 30px; background: rgba(255,255,255,0.02); border-radius: 16px;">
                    <h4 style="color: var(--text-light); margin-bottom: 15px;">
                        <i class="fas fa-lightbulb" style="color: var(--primary-yellow); margin-right: 10px;"></i>
                        Tips for Managing Positions
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 20px;">
                        <div style="text-align: left;">
                            <div style="color: var(--primary-blue); font-weight: 600; margin-bottom: 5px;">
                                <i class="fas fa-check-circle"></i> Clear Titles
                            </div>
                            <div style="color: var(--text-gray); font-size: 14px;">
                                Use descriptive titles like "President" or "Secretary"
                            </div>
                        </div>
                        <div style="text-align: left;">
                            <div style="color: var(--primary-green); font-weight: 600; margin-bottom: 5px;">
                                <i class="fas fa-check-circle"></i> Order Matters
                            </div>
                            <div style="color: var(--text-gray); font-size: 14px;">
                                Arrange positions in voting order
                            </div>
                        </div>
                        <div style="text-align: left;">
                            <div style="color: var(--primary-purple); font-weight: 600; margin-bottom: 5px;">
                                <i class="fas fa-check-circle"></i> Add Candidates
                            </div>
                            <div style="color: var(--text-gray); font-size: 14px;">
                                Add at least 2 candidates per position
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function createPosition() {
            editingPositionId = null;
            openPositionModal();
        }

        function editPosition(positionId) {
            const position = currentPositions.find(p => p.id === positionId);
            if (!position) {
                showToast("Position not found", "error");
                return;
            }
            
            editingPositionId = positionId;
            openPositionModal(position);
        }

        function openPositionModal(position = null) {
            const modal = document.getElementById('positionModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            if (!position) {
                modalTitle.textContent = "Create New Position";
                modalBody.innerHTML = `
                    <div class="form-group">
                        <label class="input-label">
                            <i class="fas fa-heading" style="margin-right: 8px;"></i>
                            Position Title
                        </label>
                        <input type="text" id="positionTitle" class="input-field" 
                               placeholder="e.g., President, Secretary, Treasurer" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="input-label">
                            <i class="fas fa-align-left" style="margin-right: 8px;"></i>
                            Description
                        </label>
                        <textarea id="positionDescription" class="input-field" rows="4"
                                  placeholder="Describe the responsibilities and role of this position..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="input-label">
                                <i class="fas fa-sort-numeric-up" style="margin-right: 8px;"></i>
                                Display Order
                            </label>
                            <input type="number" id="positionOrder" class="input-field" 
                                   value="${currentPositions.length + 1}" min="1">
                        </div>
                        <div class="form-group">
                            <label class="input-label">
                                <i class="fas fa-users" style="margin-right: 8px;"></i>
                                Maximum Winners
                            </label>
                            <input type="number" id="positionWinners" class="input-field" 
                                   value="1" min="1">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="input-label">
                            <i class="fas fa-toggle-on" style="margin-right: 8px;"></i>
                            Status
                        </label>
                        <div style="display: flex; gap: 20px; margin-top: 10px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="positionStatus" value="active" checked>
                                <span style="color: var(--text-light);">Active</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="positionStatus" value="inactive">
                                <span style="color: var(--text-light);">Inactive</span>
                            </label>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button class="btn neon-btn" style="flex: 1;" onclick="savePosition()">
                            <i class="fas fa-save"></i> Save Position
                        </button>
                        <button class="btn neon-btn-outline" onclick="closePositionModal()">
                            Cancel
                        </button>
                    </div>
                `;
            } else {
                modalTitle.textContent = "Edit Position";
                modalBody.innerHTML = `
                    <div class="form-group">
                        <label class="input-label">
                            <i class="fas fa-heading" style="margin-right: 8px;"></i>
                            Position Title
                        </label>
                        <input type="text" id="positionTitle" class="input-field" 
                               value="${position.title || ''}" 
                               placeholder="e.g., President, Secretary, Treasurer" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="input-label">
                            <i class="fas fa-align-left" style="margin-right: 8px;"></i>
                            Description
                        </label>
                        <textarea id="positionDescription" class="input-field" rows="4"
                                  placeholder="Describe the responsibilities and role of this position...">${position.description || ''}</textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="input-label">
                                <i class="fas fa-sort-numeric-up" style="margin-right: 8px;"></i>
                                Display Order
                            </label>
                            <input type="number" id="positionOrder" class="input-field" 
                                   value="${position.order || currentPositions.length + 1}" min="1">
                        </div>
                        <div class="form-group">
                            <label class="input-label">
                                <i class="fas fa-users" style="margin-right: 8px;"></i>
                                Maximum Winners
                            </label>
                            <input type="number" id="positionWinners" class="input-field" 
                                   value="${position.maxWinners || 1}" min="1">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="input-label">
                            <i class="fas fa-toggle-on" style="margin-right: 8px;"></i>
                            Status
                        </label>
                        <div style="display: flex; gap: 20px; margin-top: 10px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="positionStatus" value="active" ${position.status === 'active' ? 'checked' : ''}>
                                <span style="color: var(--text-light);">Active</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="radio" name="positionStatus" value="inactive" ${position.status === 'inactive' ? 'checked' : ''}>
                                <span style="color: var(--text-light);">Inactive</span>
                            </label>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button class="btn neon-btn" style="flex: 1;" onclick="savePosition()">
                            <i class="fas fa-save"></i> Update Position
                        </button>
                        <button class="btn neon-btn-outline" onclick="closePositionModal()">
                            Cancel
                        </button>
                    </div>
                `;
            }
            
            modal.classList.add('active');
        }

        function closePositionModal() {
            const modal = document.getElementById('positionModal');
            modal.classList.remove('active');
        }

        async function savePosition() {
            const title = document.getElementById('positionTitle').value.trim();
            const description = document.getElementById('positionDescription').value.trim();
            const order = parseInt(document.getElementById('positionOrder').value) || currentPositions.length + 1;
            const maxWinners = parseInt(document.getElementById('positionWinners').value) || 1;
            const status = document.querySelector('input[name="positionStatus"]:checked').value;
            
            if (!title) {
                showToast("Please enter a position title", "error");
                return;
            }
            
            if (maxWinners < 1) {
                showToast("Maximum winners must be at least 1", "error");
                return;
            }
            
            showToast("Saving position...", "info");
            
            try {
                const { doc, setDoc, serverTimestamp, updateDoc } = window.firebaseModules;
                
                let positionId;
                if (editingPositionId) {
                    positionId = editingPositionId;
                } else {
                    positionId = title.toLowerCase()
                        .replace(/[^a-z0-9]/g, '-')
                        .replace(/-+/g, '-')
                        .replace(/^-|-$/g, '')
                        + '-' + Date.now().toString(36);
                }
                
                const positionRef = doc(db, "organizations", currentECOrg.id, "positions", positionId);
                
                const positionData = {
                    id: positionId,
                    title: title,
                    description: description,
                    order: order,
                    maxWinners: maxWinners,
                    status: status,
                    createdAt: serverTimestamp(),
                    updatedAt: serverTimestamp(),
                    candidates: [],
                    votesCount: 0
                };
                
                if (editingPositionId) {
                    const existingPosition = currentPositions.find(p => p.id === editingPositionId);
                    if (existingPosition) {
                        positionData.candidates = existingPosition.candidates || [];
                        positionData.votesCount = existingPosition.votesCount || 0;
                        positionData.createdAt = existingPosition.createdAt || serverTimestamp();
                    }
                    
                    await updateDoc(positionRef, positionData);
                    showToast(`Position "${title}" updated successfully!`, "success");
                } else {
                    await setDoc(positionRef, positionData);
                    showToast(`Position "${title}" created successfully!`, "success");
                }
                
                closePositionModal();
                loadPositionsTab();
                
            } catch (error) {
                console.error("Error saving position:", error);
                showToast("Failed to save position: " + error.message, "error");
            }
        }

        async function deletePosition(positionId) {
            const position = currentPositions.find(p => p.id === positionId);
            if (!position) {
                showToast("Position not found", "error");
                return;
            }
            
            if (!confirm(`Are you sure you want to delete the position "${position.title}"?\nThis action cannot be undone.`)) {
                return;
            }
            
            showToast("Deleting position...", "info");
            
            try {
                const { doc, deleteDoc } = window.firebaseModules;
                const positionRef = doc(db, "organizations", currentECOrg.id, "positions", positionId);
                await deleteDoc(positionRef);
                
                showToast(`Position "${position.title}" deleted successfully`, "success");
                loadPositionsTab();
                
            } catch (error) {
                console.error("Error deleting position:", error);
                showToast("Failed to delete position: " + error.message, "error");
            }
        }

        function managePositionCandidates(positionId) {
            showToast("Candidate management feature coming soon!", "info");
            // TODO: Implement candidate management
        }

        function viewPositionResults(positionId) {
            showToast("Results viewing feature coming soon!", "info");
            // TODO: Implement results viewing
        }

        // ===== OTHER TAB FUNCTIONS =====
        async function loadVotersTab() {
            const container = document.getElementById('votersContent');
            if (!container || !currentECOrg) return;
            
            container.innerHTML = `
                <div class="loading-container">
                    <div class="spinner"></div>
                    <h3 style="color: var(--text-light); margin-bottom: 10px;">Loading Voters...</h3>
                    <p style="color: var(--text-gray);">Please wait</p>
                </div>
            `;
            
            // ... existing voters code ...
        }

        function loadCandidatesTab() {
            const container = document.getElementById('candidatesContent');
            if (!container) return;
            
            container.innerHTML = `
                <div style="text-align: center; padding: 50px 20px;">
                    <i class="fas fa-user-friends" style="font-size: 60px; color: var(--primary-blue); opacity: 0.3; margin-bottom: 20px;"></i>
                    <h3 style="color: var(--text-light); margin-bottom: 10px;">Candidates Management</h3>
                    <p style="color: var(--text-gray); margin-bottom: 30px;">Add and manage candidates for each position</p>
                    <button class="btn neon-btn" onclick="createCandidate()">
                        <i class="fas fa-plus"></i> Add Candidate
                    </button>
                </div>
            `;
        }

        function loadOutcomesTab() {
            const container = document.getElementById('outcomesContent');
            if (!container || !currentECOrg) return;
            
            const turnout = currentECOrg.voterCount 
                ? Math.round((currentECOrg.voteCount / currentECOrg.voterCount) * 100) 
                : 0;
            
            container.innerHTML = `
                <div>
                    <h3 style="color: var(--text-light); margin-bottom: 20px; font-size: 20px;">
                        <i class="fas fa-chart-line" style="margin-right: 10px; color: var(--primary-blue);"></i>
                        Election Outcomes
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div class="stat-card glass-effect" style="text-align: center;">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-value">${currentECOrg.voterCount || 0}</div>
                            <div class="stat-label">Registered Voters</div>
                        </div>
                        
                        <div class="stat-card glass-effect" style="text-align: center;">
                            <div class="stat-icon">
                                <i class="fas fa-vote-yea"></i>
                            </div>
                            <div class="stat-value">${currentECOrg.voteCount || 0}</div>
                            <div class="stat-label">Total Votes</div>
                        </div>
                        
                        <div class="stat-card glass-effect" style="text-align: center;">
                            <div class="stat-icon">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="stat-value">${turnout}%</div>
                            <div class="stat-label">Voter Turnout</div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.02); padding: 25px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.05);">
                        <h4 style="color: var(--text-light); margin-bottom: 15px; font-size: 18px;">
                            <i class="fas fa-chart-bar" style="margin-right: 8px; color: var(--primary-green);"></i>
                            Results Summary
                        </h4>
                        <p style="color: var(--text-gray); line-height: 1.6;">
                            Live results and detailed analytics will appear here as votes are cast. 
                            The system automatically tracks voting patterns and generates real-time reports.
                        </p>
                        <button class="btn neon-btn-outline mt-20" onclick="generateReport()">
                            <i class="fas fa-file-download"></i> Generate Detailed Report
                        </button>
                    </div>
                </div>
            `;
        }

        function loadSettingsTab() {
            const container = document.getElementById('settingsContent');
            if (!container || !currentECOrg) return;
            
            const status = currentECOrg.electionStatus || "active";
            const isActive = status === "active";
            
            container.innerHTML = `
                <div>
                    <h3 style="color: var(--text-light); margin-bottom: 25px; font-size: 20px;">
                        <i class="fas fa-cog" style="margin-right: 10px; color: var(--primary-blue);"></i>
                        Election Settings
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                        <div class="stat-card glass-effect">
                            <h4 style="color: var(--text-light); margin-bottom: 15px; font-size: 16px;">
                                <i class="fas fa-toggle-on" style="margin-right: 8px; color: ${isActive ? 'var(--success)' : 'var(--error)'};"></i>
                                Election Status
                            </h4>
                            <p style="color: var(--text-gray); margin-bottom: 20px; font-size: 14px;">
                                ${isActive ? 
                                    'Election is currently active. Voters can cast votes.' : 
                                    'Election is not active. Voters cannot cast votes.'}
                            </p>
                            <button class="btn ${isActive ? 'btn-warning' : 'btn-success'} w-full" onclick="toggleElectionStatus()">
                                <i class="fas fa-power-off"></i> ${isActive ? 'Close Election' : 'Open Election'}
                            </button>
                        </div>
                        
                        <div class="stat-card glass-effect">
                            <h4 style="color: var(--text-light); margin-bottom: 15px; font-size: 16px;">
                                <i class="fas fa-shield-alt" style="margin-right: 8px; color: var(--primary-yellow);"></i>
                                Security Settings
                            </h4>
                            <p style="color: var(--text-gray); margin-bottom: 20px; font-size: 14px;">
                                Manage EC password and security settings
                            </p>
                            <button class="btn neon-btn-outline w-full" onclick="changeECPassword()">
                                <i class="fas fa-key"></i> Change EC Password
                            </button>
                        </div>
                        
                        <div class="stat-card glass-effect">
                            <h4 style="color: var(--text-light); margin-bottom: 15px; font-size: 16px;">
                                <i class="fas fa-info-circle" style="margin-right: 8px; color: var(--primary-blue);"></i>
                                Organization Information
                            </h4>
                            <div style="color: var(--text-gray); font-size: 14px;">
                                <p><strong>Name:</strong> ${currentECOrg.name || currentECOrg.id}</p>
                                <p><strong>ID:</strong> ${currentECOrg.id}</p>
                                <p><strong>Status:</strong> ${status}</p>
                                <p><strong>Voters:</strong> ${currentECOrg.voterCount || 0}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function createCandidate() {
            showToast("Add candidate feature coming soon!", "info");
        }

        function generateReport() {
            showToast("Report generation feature coming soon!", "info");
        }

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            // Set up event listeners
            document.getElementById('btn-superadmin')?.addEventListener('click', () => {
                showScreen('superAdminLoginScreen');
            });
            
            document.getElementById('btn-ec')?.addEventListener('click', () => {
                showScreen('ecLoginScreen');
                checkAutoLogin();
            });
            
            document.getElementById('btn-voter')?.addEventListener('click', () => {
                showScreen('voterLoginScreen');
            });
            
            // Update Firebase status
            setTimeout(updateFirebaseStatus, 2000);
            
            console.log("🚀 Neon Voting System Initialized!");
        });

        // ===== EXPOSE FUNCTIONS TO GLOBAL SCOPE =====
        window.showScreen = showScreen;
        window.loginSuperAdmin = loginSuperAdmin;
        window.createOrganization = createOrganization;
        window.openOrgAsEC = openOrgAsEC;
        window.showPassword = showPassword;
        window.refreshOrganizations = refreshOrganizations;
        window.logout = logout;
        window.loginEC = loginEC;
        window.switchECTab = switchECTab;
        window.createPosition = createPosition;
        window.editPosition = editPosition;
        window.deletePosition = deletePosition;
        window.closePositionModal = closePositionModal;
        window.savePosition = savePosition;
        window.managePositionCandidates = managePositionCandidates;
        window.viewPositionResults = viewPositionResults;
        window.createCandidate = createCandidate;
        window.generateReport = generateReport;
    </script>
</body>
</html>