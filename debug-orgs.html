<!DOCTYPE html>
<html>
<head>
    <title>EC Access Debug - All Organizations</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBNuIYfcsi2NWkK1Ua4Tnycaf_qM3oix1s",
            authDomain: "neon-voting-app.firebaseapp.com",
            projectId: "neon-voting-app",
            storageBucket: "neon-voting-app.firebasestorage.app",
            messagingSenderId: "406871836482",
            appId: "1:406871836482:web:b25063cd3829cd3dc6aadb",
            measurementId: "G-VGW2Z3FR8M"
        };

        console.log("🔍 Starting Organization Debug...");

        try {
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            console.log("✅ Firebase initialized");

            async function showAllOrganizations() {
                try {
                    const orgsRef = collection(db, "organizations");
                    const orgsSnap = await getDocs(orgsRef);
                    
                    console.log(`Found ${orgsSnap.size} organizations`);
                    
                    let html = `
                        <div style="background:#1a1a2e;padding:20px;border-radius:10px;margin:20px 0">
                            <h2 style="color:#00eaff">📊 All Organizations (${orgsSnap.size})</h2>
                    `;
                    
                    orgsSnap.forEach(doc => {
                        const org = doc.data();
                        console.log(`- ${doc.id}:`, org);
                        
                        html += `
                            <div style="background:#16213e;margin:10px 0;padding:15px;border-radius:8px;border-left:4px solid #9D00FF">
                                <h3 style="margin:0;color:#FFD700">${org.name || "Unnamed"}</h3>
                                <p style="margin:5px 0"><strong>ID:</strong> ${doc.id}</p>
                                <p style="margin:5px 0"><strong>EC Password:</strong> ${org.ecPassword}</p>
                                <p style="margin:5px 0"><strong>Status:</strong> ${org.electionStatus || "active"}</p>
                                <p style="margin:5px 0"><strong>Type:</strong> ${org.organizationType || "Not specified"}</p>
                                
                                <button onclick="useOrg('${doc.id}', '${org.ecPassword}')" 
                                        style="background:#00C3FF;color:white;border:none;padding:8px 16px;border-radius:5px;cursor:pointer;margin-top:10px">
                                    🚀 Use This Organization
                                </button>
                            </div>
                        `;
                    });
                    
                    html += `</div>`;
                    document.getElementById("organizations").innerHTML = html;
                    
                } catch (error) {
                    console.error("❌ Error loading organizations:", error);
                    document.getElementById("organizations").innerHTML = `
                        <div style="color:#ff4444;background:rgba(255,68,68,0.1);padding:15px;border-radius:10px">
                            Error: ${error.message}
                        </div>
                    `;
                }
            }

            // Run on load
            showAllOrganizations();

        } catch (error) {
            console.error("❌ Critical error:", error);
            document.getElementById("organizations").innerHTML = `
                <div style="color:#ff4444;background:rgba(255,68,68,0.1);padding:15px;border-radius:10px">
                    ❌ CRITICAL ERROR: ${error.message}
                </div>
            `;
        }
        
        // Function to set organization for testing
        window.useOrg = function(orgId, password) {
            localStorage.setItem("currentOrgId", orgId);
            localStorage.setItem("currentECPassword", password);
            localStorage.setItem("isECLoggedIn", "true");
            
            alert(`EC Login Ready!\n\nOrganization: ${orgId}\nPassword: ${password}\n\nClick OK to go to main app.`);
            window.location.href = "index.html";
        };
    </script>
    <style>
        body { font-family: Arial; background: #0a0a1a; color: white; padding: 20px; }
        h1 { color: #00eaff; text-align: center; }
        #organizations { max-width: 800px; margin: 20px auto; }
        .spinner { margin: 0 auto 20px auto; width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.1); border-top-color: #9D00FF; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <h1>🔧 Organization Debug Tool</h1>
    <div id="organizations">
        <div style="text-align:center;padding:40px">
            <div class="spinner"></div>
            <h3>Loading organizations...</h3>
            <p>Check browser console (F12) for details</p>
        </div>
    </div>
    
    <div style="max-width:800px;margin:40px auto;background:#1a1a2e;padding:20px;border-radius:10px">
        <h2 style="color:#FFD700">📝 Quick Test</h2>
        <p>Try one of these quick tests:</p>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:15px;margin-top:15px">
            <div style="background:#16213e;padding:15px;border-radius:8px">
                <h4 style="margin:0">Option 1: demo.university.2024</h4>
                <p style="margin:5px 0">ID: demo.university.2024</p>
                <p style="margin:5px 0">Password: cc123456</p>
                <button onclick="useOrg('demo.university.2024', 'cc123456')" style="background:#9D00FF;color:white;border:none;padding:8px 16px;border-radius:5px;cursor:pointer;width:100%;margin-top:10px">
                    Use This
                </button>
            </div>
            
            <div style="background:#16213e;padding:15px;border-radius:8px">
                <h4 style="margin:0">Option 2: ark-ig0a</h4>
                <p style="margin:5px 0">ID: ark-ig0a</p>
                <p style="margin:5px 0">Password: ARK123456</p>
                <button onclick="useOrg('ark-ig0a', 'ARK123456')" style="background:#9D00FF;color:white;border:none;padding:8px 16px;border-radius:5px;cursor:pointer;width:100%;margin-top:10px">
                    Use This
                </button>
            </div>
            
            <div style="background:#16213e;padding:15px;border-radius:8px">
                <h4 style="margin:0">Option 3: lava.1980-b8m</h4>
                <p style="margin:5px 0">ID: lava.1980-b8m</p>
                <p style="margin:5px 0">Password: LC-123456</p>
                <button onclick="useOrg('lava.1980-b8m', 'LC-123456')" style="background:#9D00FF;color:white;border:none;padding:8px 16px;border-radius:5px;cursor:pointer;width:100%;margin-top:10px">
                    Use This
                </button>
            </div>
        </div>
    </div>
</body>
</html>
