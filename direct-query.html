<!DOCTYPE html>
<html>
<head>
    <title>Direct Firestore Query</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBNuIYfcsi2NWkK1Ua4Tnycaf_qM3oix1s",
            authDomain: "neon-voting-app.firebaseapp.com",
            projectId: "neon-voting-app",
            storageBucket: "neon-voting-app.firebasestorage.app",
            messagingSenderId: "406871836482",
            appId: "1:406871836482:web:b25063cd3829cd3dc6aadb",
            measurementId: "G-VGW2Z3FR8M"
        };

        async function queryAllOrgs() {
            try {
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                
                const orgsRef = collection(db, "organizations");
                const snapshot = await getDocs(orgsRef);
                
                console.log("All organizations in Firestore:", snapshot.docs.map(d => ({id: d.id, ...d.data()})));
                
                let html = `<h2>📋 All Organizations in Firestore (${snapshot.size})</h2>`;
                
                if (snapshot.empty) {
                    html += `<p style="color:#ff4444">No organizations found!</p>`;
                } else {
                    snapshot.forEach(doc => {
                        const org = doc.data();
                        html += `
                            <div style="background:#16213e;margin:10px 0;padding:15px;border-radius:8px;border-left:4px solid #9D00FF">
                                <h3 style="margin:0;color:#FFD700">${org.name || "Unnamed"}</h3>
                                <p style="margin:5px 0"><strong>ID:</strong> <code>${doc.id}</code></p>
                                <p style="margin:5px 0"><strong>EC Password:</strong> ${org.ecPassword}</p>
                                <p style="margin:5px 0"><strong>Status:</strong> ${org.electionStatus || "active"}</p>
                                <p style="margin:5px 0"><strong>Type:</strong> ${org.organizationType || "Not specified"}</p>
                                
                                <div style="margin-top:10px">
                                    <button onclick="testLogin('${doc.id}', '${org.ecPassword}')" 
                                            style="background:#00C3FF;color:white;border:none;padding:8px 16px;border-radius:5px;cursor:pointer;margin-right:10px">
                                        Test Login
                                    </button>
                                    <button onclick="copyId('${doc.id}')" 
                                            style="background:#444;color:white;border:none;padding:8px 16px;border-radius:5px;cursor:pointer">
                                        Copy ID
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                }
                
                document.getElementById("orgs").innerHTML = html;
                
            } catch (error) {
                document.getElementById("orgs").innerHTML = `
                    <div style="color:#ff4444;background:rgba(255,68,68,0.1);padding:15px;border-radius:10px">
                        ❌ Error: ${error.message}
                    </div>
                `;
                console.error("Error:", error);
            }
        }
        
        window.testLogin = function(orgId, password) {
            localStorage.setItem("currentOrgId", orgId);
            localStorage.setItem("currentECPassword", password);
            localStorage.setItem("isECLoggedIn", "true");
            
            alert(`Login set!\nOrg: ${orgId}\nPass: ${password}\n\nRedirecting to main app...`);
            window.location.href = "index.html";
        };
        
        window.copyId = function(orgId) {
            navigator.clipboard.writeText(orgId);
            alert(`Copied: ${orgId}`);
        };
        
        // Run on load
        document.addEventListener("DOMContentLoaded", queryAllOrgs);
    </script>
    <style>
        body { font-family: Arial; background: #0a0a1a; color: white; padding: 20px; }
        h1 { color: #00eaff; text-align: center; }
        #orgs { max-width: 800px; margin: 20px auto; }
    </style>
</head>
<body>
    <h1>🔍 Direct Firestore Query</h1>
    <div id="orgs">
        <div style="text-align:center;padding:40px">
            <div class="spinner" style="margin:0 auto 20px auto;width:40px;height:40px;border:4px solid rgba(255,255,255,0.1);border-top-color:#9D00FF;border-radius:50%;animation:spin 1s linear infinite"></div>
            <h3>Querying Firestore...</h3>
        </div>
    </div>
</body>
</html>
